# Development Safety Configuration for Tiny Chaos Framework
# Permissive policies for development and testing environments

# Global safety settings
global:
  max_duration: 7200  # 2 hours - permissive for dev work
  require_confirmation: false
  auto_detect_environment: true

# Environment detection rules
environment_detection:
  cloud_providers:
    aws:
      metadata_url: "http://169.254.169.254/latest/meta-data/"
      timeout: 2
    gcp:
      metadata_url: "http://metadata.google.internal/computeMetadata/v1/"
      timeout: 2
    azure:
      metadata_url: "http://169.254.169.254/metadata/instance/"
      timeout: 2

  classification_rules:
    - name: "production"
      patterns:
        hostname: ["prod-*", "*-prod", "*production*", "*prd*"]
        environment_vars: ["ENVIRONMENT=prod", "ENVIRONMENT=production"]
        cloud_tags: ["environment=production", "stage=prod"]

    - name: "staging"
      patterns:
        hostname: ["staging-*", "*-staging", "*stage*", "*stg*"]
        environment_vars: ["ENVIRONMENT=staging", "STAGE=staging"]
        cloud_tags: ["environment=staging", "stage=staging"]

    - name: "development"
      patterns:
        hostname: ["dev-*", "*-dev", "*development*", "localhost*", "*local*"]
        environment_vars: ["ENVIRONMENT=dev", "STAGE=development", "ENV=dev"]
        cloud_tags: ["environment=development", "stage=dev"]

    - name: "test"
      patterns:
        hostname: ["test-*", "*-test", "*testing*"]
        environment_vars: ["ENVIRONMENT=test", "STAGE=test"]
        cloud_tags: ["environment=test", "stage=test"]

# Per-environment safety policies - Development focused
environment_policies:
  production:
    enabled: false  # Still block production
    max_duration: 0
    allowed_experiment_types: []
    protected_services: ["*"]
    require_confirmation: true
    require_approval: true

  staging:
    enabled: true
    max_duration: 3600  # 1 hour
    allowed_experiment_types: ["*"]  # All types allowed
    protected_services: ["payment", "billing"]  # Only truly critical services
    require_confirmation: false
    require_approval: false

  development:
    enabled: true
    max_duration: 7200  # 2 hours
    allowed_experiment_types: ["*"]  # All experiment types
    protected_services: []  # No protected services in dev
    require_confirmation: false
    require_approval: false

  test:
    enabled: true
    max_duration: 14400  # 4 hours for long-running tests
    allowed_experiment_types: ["*"]
    protected_services: []
    require_confirmation: false
    require_approval: false

  default:
    enabled: true  # Permissive default for dev environments
    max_duration: 1800  # 30 minutes
    allowed_experiment_types: ["cpu_stress", "memory_exhaust"]
    protected_services: ["payment", "billing"]
    require_confirmation: false
    require_approval: false

# Permissive experiment-specific safety rules
experiment_safety:
  cpu_stress:
    max_intensity: 95  # Allow high CPU usage
    min_available_cores: 0  # No restriction on cores

  memory_exhaust:
    max_memory_percentage: 90  # Allow high memory usage
    min_free_memory_mb: 256  # Minimal free memory requirement

  network_latency:
    max_latency_ms: 10000  # Allow up to 10 seconds latency for testing
    allowed_interfaces: ["*"]  # All interfaces allowed

# Optional service discovery
service_discovery:
  kubernetes:
    enabled: false  # Disabled by default in dev
    namespace_patterns: ["kube-system"]

  consul:
    enabled: false  # Disabled by default in dev
    url: "http://localhost:8500"
    protected_service_tags: ["critical"]

# Minimal notifications
notifications:
  slack:
    enabled: false
    webhook_url: ""
    channel: "#dev-chaos"

  email:
    enabled: false
    smtp_server: ""
    recipients: []

# Basic audit for development
audit:
  log_safety_decisions: false  # Disabled for dev speed
  log_file: "./logs/dev_safety.log"
  include_experiment_details: false
  retain_logs_days: 7